<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Staff Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    background: url("{{ url_for('static', filename='background.jpg') }}") no-repeat center center/cover;
    min-height: 100vh;
    padding: 30px;
    color: white;
}

.glass-box {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

h2 {
    font-weight: 600;
}

.table thead th {
    color: white;
    font-weight: 600;
}

.status-badge {
    padding: 5px 8px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-active { background: rgba(0,255,0,0.3); }
.status-done { background: rgba(0,123,255,0.3); }
.status-cancelled { background: rgba(255,0,0,0.3); }
.status-expired { background: rgba(255,165,0,0.3); }

.logout-btn {
    position: absolute;
    top: 20px;
    right: 20px;
}
</style>
</head>
<body>

<a href="{{ url_for('staff_logout') }}" class="btn btn-danger logout-btn">Logout</a>

<div class="container">
    <div class="glass-box">
    <h2>Welcome, {{ user }}</h2>
    <p class="text-light">
        üìÖ Date: <strong>{{ tokens[0].date if tokens else "No bookings yet" }}</strong>
    </p>
    <p class="text-light">
    üè¢ Department:
    <strong>{{ department }}</strong>
    </p>

</div>


    <div class="glass-box mt-3">
        <h4>üìä Today's Stats</h4>
        <p>üü¢ Active: <strong>{{ stats.active }}</strong> | üîµ Completed: <strong>{{ stats.completed }}</strong></p>
        <p>‚è± Avg Time: <strong>{{ stats.avg_wait }} min</strong> | üöÄ Fastest: <strong>{{ stats.fastest }} min</strong></p>
    </div>

    <div class="glass-box mt-3">
        <h4>üîΩ Token Queue</h4>
        <div class="table-responsive">
        <table class="table table-bordered table-hover text-white">
            <thead>
                <tr>
                    <th>Token</th>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Issue</th>
                    <th>Department</th>
                    <th>Time Slot</th>
                    <th>Valid (15 min)</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            {% for token in tokens %}
                <tr>
                    <td>{{ token.token_number }}</td>
                    <td>{{ token.name }}</td>
                    <td>{{ token.phone }}</td>
                    <td>{{ token.issue }}</td>
                    <td>{{ token.department }}</td>
                    <td>{{ token.slot_time }}</td>
                    <td>{{ token.start_time }} - {{ token.end_time }}</td>

                    <td>
                        {% if token.status == "Active" %}
                            <span class="status-badge status-active">Active</span>
                        {% elif token.status == "Done" %}
                            <span class="status-badge status-done">Done</span>
                        {% elif token.status == "Cancelled" %}
                            <span class="status-badge status-cancelled">Cancelled</span>
                        {% elif token.status == "Expired" %}
                            <span class="status-badge status-expired">Expired</span>
                        {% else %}
                            <span>{{ token.status }}</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if token.status == "Active" %}
                            <form action="/done/{{ token.token_number }}" method="POST" style="display:inline-block;">
                                <button type="submit" class="btn btn-success btn-sm">Done</button>
                            </form>
                            <form action="/cancel/{{ token.token_number }}" method="POST" style="display:inline-block;">
                                <button type="submit" class="btn btn-danger btn-sm">Cancel</button>
                            </form>
                        {% else %}
                            <small class="text-muted">N/A</small>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</div>

</body>
</html>
